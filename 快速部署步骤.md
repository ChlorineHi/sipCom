# 🚀 客户端快速部署步骤

## 整体流程图

```
┌─────────────────────────────────────────────────────────────────┐
│                        服务器电脑操作                            │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │ 1. 运行构建脚本   │
                    │ build-client-    │
                    │ for-remote.bat   │
                    └──────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │ 2. 生成部署包     │
                    │ client-deploy/   │
                    │   ├─ jar文件     │
                    │   └─ start.bat   │
                    └──────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │ 3. 复制到U盘或    │
                    │    网络共享       │
                    └──────────────────┘
                              │
┌─────────────────────────────┼─────────────────────────────────┐
│                        客户端电脑操作                           │
└─────────────────────────────┼─────────────────────────────────┘
                              ▼
                    ┌──────────────────┐
                    │ 1. 检查Java环境   │
                    │ java -version    │
                    └──────────────────┘
                              │
                    ┌─────────┴─────────┐
                    │                   │
                ❌ 未安装          ✅ 已安装
                    │                   │
                    ▼                   ▼
            ┌──────────────┐    ┌──────────────┐
            │ 安装Java JDK  │    │ 2. 测试网络   │
            │ (JDK 8+)     │    │ ping服务器    │
            └──────────────┘    └──────────────┘
                    │                   │
                    └─────────┬─────────┘
                              ▼
                    ┌──────────────────┐
                    │ 3. 复制部署包     │
                    │ 到本地文件夹      │
                    └──────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │ 4. 双击start.bat  │
                    │    启动程序       │
                    └──────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │ 5. 登录测试       │
                    │ alice/123456     │
                    └──────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │ ✅ 配置完成！     │
                    └──────────────────┘
```

---

## 📝 详细步骤

### 第一部分：服务器电脑操作（5分钟）

#### ✅ 步骤1：构建客户端包

**位置**：服务器电脑（当前这台，E:\sipEx）

**操作**：
```batch
# 双击运行这个文件
build-client-for-remote.bat
```

**预期结果**：
```
========================================
  构建远程客户端部署包
========================================

[1/4] 备份原始配置文件...
✓ 备份完成

[2/4] 修改服务器地址为: 10.129.161.35
✓ 配置已更新

[3/4] 编译打包项目...
✓ 编译完成

[4/4] 创建部署包...
✓ 部署包创建完成

[5/4] 恢复原始配置...
✓ 配置已恢复

========================================
  构建成功！
========================================

部署包位置: E:\sipEx\client-deploy
```

#### ✅ 步骤2：查看生成的文件

**位置**：`E:\sipEx\client-deploy\`

**文件清单**：
```
client-deploy/
├── sip-client-1.0.0.jar    # 约 50-100 MB
└── start.bat               # 约 1 KB
```

#### ✅ 步骤3：传输到客户端电脑

**方法选择**：

**方法A：U盘拷贝（推荐）**
```
1. 插入U盘
2. 复制整个 client-deploy 文件夹到U盘
3. 在客户端电脑上从U盘复制到本地
```

**方法B：网络共享**
```
1. 右键 client-deploy 文件夹 → 属性 → 共享
2. 在客户端电脑上访问：\\10.129.161.35\client-deploy
3. 复制到本地
```

**方法C：QQ/微信等（如果文件不大）**
```
1. 压缩 client-deploy 文件夹
2. 通过 QQ/微信 传给自己
3. 在客户端电脑上下载并解压
```

---

### 第二部分：客户端电脑操作（10分钟）

#### ✅ 步骤1：检查Java环境

**打开命令提示符**：
- 按 `Win + R`
- 输入 `cmd`
- 回车

**检查Java版本**：
```bash
java -version
```

**情况A：显示版本号（已安装）**
```
java version "1.8.0_301"
Java(TM) SE Runtime Environment (build 1.8.0_301-b09)
```
✅ **跳到步骤2**

**情况B：报错（未安装）**
```
'java' 不是内部或外部命令...
```
❌ **需要安装Java** → 见下方"安装Java"

---

#### 🔧 安装Java（如果需要）

**下载地址**：
- 官方：https://www.oracle.com/java/technologies/downloads/
- 或：https://adoptium.net/ (免费开源)

**安装步骤**：
1. 下载 Windows x64 Installer (约 150 MB)
2. 双击安装文件
3. 点击"下一步"使用默认设置
4. 等待安装完成（约2-3分钟）
5. **重新打开命令提示符**
6. 再次运行 `java -version` 验证

---

#### ✅ 步骤2：测试网络连接

**在命令提示符中**：
```bash
ping 10.129.161.35
```

**预期结果**：
```
正在 Ping 10.129.161.35 具有 32 字节的数据:
来自 10.129.161.35 的回复: 字节=32 时间<1ms TTL=128
来自 10.129.161.35 的回复: 字节=32 时间<1ms TTL=128
```

**如果显示"请求超时"**：
1. 检查两台电脑是否在同一网络
2. 检查服务器电脑是否开机
3. 检查网线/WiFi连接

---

#### ✅ 步骤3：复制并解压文件

**从U盘/网络复制**：
```
1. 将 client-deploy 文件夹复制到桌面或任意位置
   例如：C:\sipex\client-deploy\

2. 确认文件完整：
   ✓ sip-client-1.0.0.jar (约 50-100 MB)
   ✓ start.bat (约 1 KB)
```

---

#### ✅ 步骤4：启动客户端

**方法1：使用启动脚本（推荐）**
```
1. 进入 client-deploy 文件夹
2. 双击 start.bat
3. 等待程序启动（约5-10秒）
```

**方法2：命令行运行**
```bash
cd C:\sipex\client-deploy
java -jar sip-client-1.0.0.jar
```

**预期效果**：
```
========================================
   SipEx 客户端
   服务器: 10.129.161.35:8080
========================================

正在启动客户端...
[程序窗口打开]
```

---

#### ✅ 步骤5：登录测试

**在登录界面**：
```
服务器地址：http://10.129.161.35:8080 (应该已预填)
用户名：alice
密码：123456
```

**点击"登录"**

**预期结果**：
```
✓ 连接服务器成功
✓ 登录成功
✓ SIP注册成功
✓ 进入主界面
```

---

## 🎯 多客户端部署

### 场景：3台电脑同时运行

| 电脑 | 复制文件 | 账号 | 说明 |
|------|---------|------|------|
| 服务器电脑 | ✅ 可运行客户端 | alice | 服务端+客户端 |
| 客户端电脑A | ✅ 复制 client-deploy | bob | 只需客户端 |
| 客户端电脑B | ✅ 复制 client-deploy | charlie | 只需客户端 |

**每台电脑的步骤完全相同**！

---

## ⏱️ 时间估算

| 操作 | 预计时间 | 说明 |
|------|---------|------|
| 服务器：构建部署包 | 2-5分钟 | 取决于电脑性能 |
| 传输文件 | 1-5分钟 | 取决于传输方式 |
| 客户端：检查Java | 1分钟 | 如已安装 |
| 客户端：安装Java | 5-10分钟 | 如未安装 |
| 客户端：启动测试 | 2分钟 | - |
| **总计（已有Java）** | **10-15分钟** | - |
| **总计（需装Java）** | **15-25分钟** | - |

---

## 🔍 问题速查

### ❌ 问题：java 不是内部或外部命令

**原因**：未安装Java或未配置环境变量

**解决**：
1. 下载安装 Java JDK
2. 重启命令提示符
3. 如仍报错，手动配置环境变量

---

### ❌ 问题：ping 请求超时

**原因**：网络不通

**解决**：
1. 检查两台电脑是否在同一局域网
2. 检查服务器电脑防火墙
3. 尝试 `ping` 其他设备测试网络

---

### ❌ 问题：双击 start.bat 闪退

**原因**：可能是路径问题或Java未正确安装

**解决**：
```bash
# 用命令行运行查看错误信息
cd client-deploy
start.bat
# 查看具体错误信息
```

---

### ❌ 问题：能启动但无法连接服务器

**原因**：服务器未启动或防火墙阻止

**检查服务器端**：
```bash
# 1. 检查 Spring Boot 是否运行（端口8080）
netstat -ano | findstr :8080

# 2. 检查防火墙规则
# 控制面板 → Windows Defender 防火墙 → 高级设置
```

**测试连接**：
```bash
# 在客户端电脑浏览器访问
http://10.129.161.35:8080
# 应该能看到页面（即使是错误页面也说明连接正常）
```

---

### ❌ 问题：能登录但无法通话

**原因**：RTP端口被阻止

**解决**：
1. 检查对方是否在线
2. 暂时关闭双方防火墙测试
3. 查看控制台错误信息

---

## ✅ 配置成功标志

### 客户端启动成功
```
✓ 程序窗口打开
✓ 能看到登录界面
✓ 服务器地址自动填写
```

### 登录成功
```
✓ 输入账号密码后能登录
✓ 控制台显示"连接成功"
✓ 进入主界面
```

### SIP注册成功
```
✓ 控制台显示"SIP注册成功"
✓ 状态显示"在线"
✓ 能看到其他在线用户
```

### 通话成功
```
✓ 能搜索到其他用户
✓ 能发起通话
✓ 能听到对方声音
✓ 对方能听到你的声音
```

---

## 📋 完整检查清单

打印此清单，逐项检查：

### 服务器电脑
- [ ] 运行 `build-client-for-remote.bat`
- [ ] 生成 `client-deploy` 文件夹
- [ ] 文件夹包含 jar 和 bat 文件
- [ ] 复制到U盘或共享

### 客户端电脑
- [ ] Java 已安装（`java -version`）
- [ ] 网络连通（`ping 10.129.161.35`）
- [ ] 从U盘复制文件到本地
- [ ] 双击 `start.bat` 能启动
- [ ] 能看到登录界面
- [ ] 使用 alice/123456 能登录
- [ ] 控制台显示"SIP注册成功"
- [ ] 状态显示"在线"

### 功能测试
- [ ] 能搜索用户
- [ ] 能发送消息
- [ ] 能发起通话
- [ ] 能接听通话
- [ ] 音频正常
- [ ] 视频正常（如果有）

---

## 🎓 提示和技巧

### 💡 提示1：同一台电脑测试
在开始跨电脑测试前，可以先在服务器电脑上运行两个客户端：
```
# 终端1
java -jar sip-client-1.0.0.jar
# 登录 alice

# 终端2
java -jar sip-client-1.0.0.jar
# 登录 bob
```

### 💡 提示2：查看详细日志
如果遇到问题，查看客户端控制台输出的详细信息

### 💡 提示3：一步步验证
不要跳过网络测试步骤，确保每一步都成功

### 💡 提示4：防火墙规则
如果通话有问题，最快的测试方法是暂时关闭防火墙

---

## 📚 下一步

配置完成后，参考这些文档学习使用：

1. **基本使用**
   - `启动指南.md` - 如何启动系统
   - `操作报告.md` - 功能说明

2. **进阶功能**
   - `Linphone测试指南.md` - 详细测试方法
   - `Linphone视频配置说明.md` - 视频通话配置

3. **问题排查**
   - `问题排查与解决方案.md` - 遇到问题时查阅
   - `网络架构说明.md` - 架构和故障排查

---

## 📞 获取帮助

如果遇到问题：
1. 查看上方"问题速查"部分
2. 检查控制台错误信息
3. 参考 `客户端电脑配置清单.md`
4. 查看 `问题排查与解决方案.md`

---

**祝配置顺利！🎉**

