# SIP即时通信系统 - 快速启动指南

## 系统状态

✅ 项目编译完成
✅ 数据库初始化完成  
✅ 服务器已启动（端口8080）
✅ 客户端已启动

## 测试账号

所有测试账号密码均为：`123456`

| 用户名  | SIP URI                      | 说明     |
|---------|------------------------------|----------|
| alice   | sip:alice@172.22.189.160     | 测试用户1 |
| bob     | sip:bob@172.22.189.160       | 测试用户2 |
| charlie | sip:charlie@172.22.189.160   | 测试用户3 |
| david   | sip:david@172.22.189.160     | 测试用户4 |

## 测试步骤

### 1. 基本登录测试

1. 在客户端界面输入用户名：`alice`
2. 输入密码：`123456`
3. 点击"登录"按钮
4. 观察：
   - 顶部显示"当前用户: alice"
   - 状态显示"已连接"
   - SIP状态显示"已注册"
   - 左侧显示联系人列表（bob, charlie, david）

### 2. 消息发送测试

#### 方式A：在同一客户端测试（推荐）
1. 登录alice账号
2. 点击左侧联系人"bob"
3. 在消息输入框输入：`Hello Bob, this is Alice!`
4. 点击"发送"按钮
5. 观察消息显示在聊天窗口

#### 方式B：双客户端测试
1. 当前客户端登录alice
2. 再启动一个客户端实例登录bob
3. 在alice的客户端向bob发送消息
4. 在bob的客户端应该收到消息通知

**启动第二个客户端：**
```powershell
# 新开一个PowerShell窗口
cd E:\sipEx\sip-client
mvn javafx:run
```

### 3. 音频通话测试

1. alice选择联系人bob
2. 点击"语音通话"按钮
3. 观察SIP INVITE信令（控制台会打印）
4. 如果bob在线，会收到来电通知

**注意**：音视频功能为演示版本，实际媒体流未实现完整的编解码。

### 4. 群聊测试

1. 切换到"群组"标签
2. 选择群组（ProjectTeam 或 TechTalk）
3. 发送消息到群组
4. 观察消息发送

### 5. 管理后台测试

1. 点击右下角"管理后台"按钮
2. 查看统计信息：
   - 总用户数：4
   - 总消息数：根据测试情况
   - 今日消息数：当天发送的消息数量
3. 切换到不同标签页查看：
   - 用户列表
   - 群组列表
   - 通话记录

### 6. 与Linphone互通测试

#### 配置Linphone
1. 下载并安装Linphone Desktop
2. 添加SIP账号：
   - 用户名：bob
   - 域名：172.22.189.160
   - 传输协议：UDP
   - 端口：5060

#### 测试消息互通
1. 本系统客户端登录alice
2. Linphone登录bob
3. alice向bob发送SIP MESSAGE
4. Linphone应该能收到消息

**查看SIP消息日志：**
查看客户端目录下的 `siplog_alice.txt` 和 `sipserver_alice.txt` 文件

## 故障排除

### 服务器未启动
```powershell
cd E:\sipEx\sip-server
java -jar target\sip-server-1.0.0.jar
```

### 客户端启动失败
检查错误信息，常见问题：
- JavaFX依赖问题
- 端口被占用
- 服务器未启动

### SIP注册失败
- 检查Kamailio Docker容器是否运行
- 检查网络连接到172.22.189.160:5060
- 查看siplog文件

### 数据库连接失败
```powershell
# 检查MySQL服务
mysql -u root -p123456 -e "USE sipex; SHOW TABLES;"
```

## 功能验证清单

- [x] 用户登录注册
- [x] SIP注册到Kamailio
- [x] 发送SIP MESSAGE
- [x] 接收SIP MESSAGE
- [x] 发起音视频通话（INVITE）
- [x] 接收来电（收到INVITE）
- [x] 文件上传
- [x] 群组消息
- [x] 后台管理统计
- [ ] 与Linphone完整互通（需要Linphone配置）

## 日志文件位置

- **服务器日志**：控制台输出
- **客户端SIP日志**：`sip-client/siplog_<username>.txt`
- **客户端SIP服务器日志**：`sip-client/sipserver_<username>.txt`

## API测试

### 获取统计信息
```powershell
Invoke-WebRequest -Uri "http://localhost:8080/api/admin/statistics" | Select-Object -ExpandProperty Content
```

### 获取用户列表
```powershell
Invoke-WebRequest -Uri "http://localhost:8080/api/users" | Select-Object -ExpandProperty Content
```

### 查看数据库
```powershell
mysql -u root -p123456 sipex -e "SELECT * FROM users"
mysql -u root -p123456 sipex -e "SELECT * FROM messages"
mysql -u root -p123456 sipex -e "SELECT * FROM call_logs"
```

## 重新启动

### 停止所有服务
```powershell
# 关闭客户端：直接关闭窗口
# 停止服务器：Ctrl+C 或关闭PowerShell窗口
```

### 完整重启
```powershell
# 1. 启动服务器
cd E:\sipEx\sip-server
java -jar target\sip-server-1.0.0.jar

# 2. 等待10秒

# 3. 启动客户端（新窗口）
cd E:\sipEx\sip-client
mvn javafx:run
```

## 联系方式

如遇问题，请查看：
- README.md - 项目说明
- 操作报告.md - 详细技术文档
- 日志文件 - 错误信息

祝测试顺利！🚀

