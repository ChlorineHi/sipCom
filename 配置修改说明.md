# 客户端配置修改说明

## 当前配置状态

### ClientConfig.java 当前配置：
```java
// HTTP 服务器配置
public static final String SERVER_HOST = "localhost";  // ⚠️ 需要修改
public static final int SERVER_PORT = 8080;

// Kamailio SIP 服务器配置
public static final String KAMAILIO_HOST = "10.129.161.35";  // ✅ 已正确配置
public static final int KAMAILIO_PORT = 5060;
```

## 部署方案选择

### 📌 方案一：快速部署（推荐）- 在客户端电脑直接运行命令

**适用场景**: 临时测试、快速部署

**步骤**：

1. 将打包好的 `sip-client-1.0.0.jar` 复制到客户端电脑

2. 在客户端电脑上运行（指定服务器地址）：
```bash
java -Dserver.host=10.129.161.35 -jar sip-client-1.0.0.jar
```

**优点**: 
- ✅ 不需要修改代码
- ✅ 不需要重新编译
- ✅ 可以灵活切换服务器地址

**缺点**: 
- ⚠️ 需要在代码中支持系统属性读取（需要添加代码）

---

### 📌 方案二：修改配置文件后重新打包（最稳定）

**适用场景**: 正式部署、长期使用

**步骤**：

#### 1. 修改配置文件

编辑 `sip-client/src/main/java/com/sipex/client/config/ClientConfig.java`：

```java
// 修改前：
public static final String SERVER_HOST = "localhost";

// 修改后：
public static final String SERVER_HOST = "10.129.161.35";
```

#### 2. 重新打包

```bash
# 在服务器电脑上执行
cd E:\sipEx
mvn clean package -DskipTests
```

#### 3. 复制到客户端电脑

将以下文件复制到客户端电脑：
- `sip-client/target/sip-client-1.0.0.jar`

#### 4. 在客户端电脑运行

```bash
java -jar sip-client-1.0.0.jar
```

**优点**: 
- ✅ 配置固定，不会出错
- ✅ 用户使用简单

**缺点**: 
- ⚠️ 切换服务器需要重新编译

---

### 📌 方案三：复制整个项目到客户端（开发模式）

**适用场景**: 需要在客户端电脑上开发或调试

**步骤**：

#### 1. 复制项目文件

复制以下目录到客户端电脑：
```
E:\sipEx\
├── sip-client\      # 客户端模块（必需）
├── sip-common\      # 公共模块（必需）
├── pom.xml          # 父 POM（必需）
└── .gitignore       # 可选
```

**注意**: 不需要复制 `sip-server` 目录！

#### 2. 修改配置

在客户端电脑上，编辑 `sip-client/src/main/java/com/sipex/client/config/ClientConfig.java`

```java
public static final String SERVER_HOST = "10.129.161.35";
```

#### 3. 安装 Maven 和 JDK

确保客户端电脑已安装：
- JDK 8 或更高版本
- Maven 3.6 或更高版本

#### 4. 编译并运行

```bash
cd sipEx
mvn clean package -DskipTests
cd sip-client
java -jar target\sip-client-1.0.0.jar
```

---

## 配置项详细说明

### ClientConfig.java 完整配置

```java
package com.sipex.client.config;

public class ClientConfig {
    // ========== HTTP/WebSocket 服务器配置 ==========
    // 用于：用户认证、消息传递、文件上传下载
    public static final String SERVER_HOST = "10.129.161.35";  // 修改这里！
    public static final int SERVER_PORT = 8080;
    public static final String SERVER_URL = "http://" + SERVER_HOST + ":" + SERVER_PORT;
    public static final String WS_URL = "ws://" + SERVER_HOST + ":" + SERVER_PORT + "/ws";

    // ========== Kamailio SIP 服务器配置 ==========
    // 用于：SIP 注册、通话建立
    public static final String KAMAILIO_HOST = "10.129.161.35";  // 已正确
    public static final int KAMAILIO_PORT = 5060;
    public static final String SIP_DOMAIN = KAMAILIO_HOST;

    // ========== 本地客户端配置 ==========
    // 自动获取，通常不需要修改
    public static String LOCAL_IP = getLocalIP();
    public static final int LOCAL_SIP_PORT = 5070;
    
    private static String getLocalIP() {
        try {
            return java.net.InetAddress.getLocalHost().getHostAddress();
        } catch (Exception e) {
            return "127.0.0.1";
        }
    }

    // ========== RTP 媒体流配置 ==========
    // 用于：音视频传输
    public static final int RTP_PORT_START = 10000;
    public static final int RTP_PORT_END = 20000;
}
```

---

## 快速修改工具

### Windows 批处理脚本

创建 `update-server-ip.bat`（放在项目根目录）：

```batch
@echo off
set SERVER_IP=10.129.161.35

echo 正在更新服务器地址为: %SERVER_IP%

powershell -Command "(gc sip-client\src\main\java\com\sipex\client\config\ClientConfig.java) -replace 'SERVER_HOST = \"localhost\"', 'SERVER_HOST = \"%SERVER_IP%\"' | Out-File -encoding UTF8 sip-client\src\main\java\com\sipex\client\config\ClientConfig.java"

echo 更新完成！
echo 请运行: mvn clean package -DskipTests
pause
```

---

## 网络连通性测试

在客户端电脑上测试：

### 1. 测试网络连通性
```bash
ping 10.129.161.35
```

### 2. 测试 HTTP 端口
```bash
curl http://10.129.161.35:8080
# 或在浏览器访问: http://10.129.161.35:8080
```

### 3. 测试 SIP 端口（可选）
```bash
# 使用 telnet 或 PowerShell
Test-NetConnection -ComputerName 10.129.161.35 -Port 8080
Test-NetConnection -ComputerName 10.129.161.35 -Port 5060
```

---

## 推荐操作流程

### 🎯 推荐：方案二（修改配置后重新打包）

1. **在服务器电脑上**（E:\sipEx）：
   ```bash
   # 1. 修改配置文件
   # 编辑 sip-client/src/main/java/com/sipex/client/config/ClientConfig.java
   # 将 SERVER_HOST 改为 "10.129.161.35"
   
   # 2. 重新打包
   mvn clean package -DskipTests
   
   # 3. 复制 jar 到 U 盘或共享文件夹
   # 文件位置: sip-client\target\sip-client-1.0.0.jar
   ```

2. **在客户端电脑上**：
   ```bash
   # 1. 将 jar 文件复制到任意目录
   # 2. 运行
   java -jar sip-client-1.0.0.jar
   ```

---

## 常见问题

### Q1: 为什么有两个 HOST 配置？

**A**: 
- `SERVER_HOST`: Spring Boot 后端服务器地址（用于 HTTP/WebSocket）
- `KAMAILIO_HOST`: Kamailio SIP 服务器地址（用于 SIP 信令）

在你的配置中，两者都指向同一台服务器（10.129.161.35），但端口不同。

### Q2: 客户端电脑需要安装 MySQL 吗？

**A**: 不需要！MySQL 只在服务器端运行，客户端通过 HTTP API 访问数据。

### Q3: 客户端电脑需要安装 Kamailio 吗？

**A**: 不需要！Kamailio 只在服务器端运行，客户端作为 SIP UA（用户代理）连接到 Kamailio。

### Q4: 可以在外网访问吗？

**A**: 
- 局域网内：直接使用内网 IP（10.129.161.35）
- 外网访问：需要配置端口转发或使用公网 IP/域名

### Q5: 多个客户端可以使用同一个账号吗？

**A**: 建议每个客户端使用不同账号（alice, bob, charlie 等），避免冲突。

---

## 下一步

修改配置文件后，请参考：
- `客户端部署指南.md` - 详细部署步骤
- `启动指南.md` - 服务器和客户端启动流程
- `问题排查与解决方案.md` - 遇到问题时的排查方法

