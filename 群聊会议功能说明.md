# ç¾¤èŠéŸ³è§†é¢‘ä¼šè®®åŠŸèƒ½è¯´æ˜Ž

## åŠŸèƒ½æ¦‚è¿°

å·²æˆåŠŸå®žçŽ°3-5äººç¾¤èŠéŸ³è§†é¢‘ä¼šè®®åŠŸèƒ½ï¼Œé‡‡ç”¨Meshæž¶æž„ï¼ˆP2Pç½‘çŠ¶è¿žæŽ¥ï¼‰ï¼Œæ”¯æŒä¸´æ—¶ä¼šè®®å®¤æ¨¡å¼ã€‚

## æ ¸å¿ƒç‰¹æ€§

### âœ… å·²å®žçŽ°åŠŸèƒ½

1. **ä¼šè®®å®¤ç®¡ç†**
   - åˆ›å»ºä¸´æ—¶ä¼šè®®å®¤ï¼ˆè‡ªåŠ¨åˆ†é…æˆ¿é—´å·ï¼Œå¦‚ROOM-1234ï¼‰
   - åŠ å…¥ä¼šè®®å®¤ï¼ˆè¾“å…¥æˆ¿é—´å·ï¼‰
   - è‡ªåŠ¨æ¸…ç†è¿‡æœŸä¼šè®®å®¤ï¼ˆ30åˆ†é’Ÿæ— æ´»åŠ¨ï¼‰
   - æœ€å¤§æ”¯æŒ5äººåŒæ—¶å‚ä¸Ž

2. **éŸ³è§†é¢‘é€šä¿¡**
   - å¤šè·¯éŸ³é¢‘æ··éŸ³ï¼ˆå°†å¤šä¸ªå‚ä¸Žè€…éŸ³é¢‘æ··åˆæ’­æ”¾ï¼‰
   - è§†é¢‘ç½‘æ ¼å¸ƒå±€ï¼ˆåŠ¨æ€è°ƒæ•´2x2æˆ–2x3å¸ƒå±€ï¼‰
   - P2Pç›´è¿žä¼ è¾“ï¼ˆMeshæž¶æž„ï¼‰
   - RTPåè®®æ”¯æŒ

3. **ç”¨æˆ·ç•Œé¢**
   - ç‹¬ç«‹ä¼šè®®çª—å£ï¼ˆä¸å½±å“ä¸»ç•Œé¢ï¼‰
   - å®žæ—¶å‚ä¸Žè€…åˆ—è¡¨
   - è§†é¢‘ç½‘æ ¼æ˜¾ç¤º
   - æŽ§åˆ¶æŒ‰é’®ï¼ˆé™éŸ³ã€å…³é—­è§†é¢‘ç­‰ï¼‰

4. **åŠŸèƒ½éš”ç¦»**
   - ç¾¤èŠä¼šè®®ä¸Žå•äººé€šè¯å®Œå…¨ç‹¬ç«‹
   - ä½¿ç”¨ä¸åŒçš„SIPç«¯å£ï¼ˆé¿å…å†²çªï¼‰
   - ç‹¬ç«‹çš„åª’ä½“ç®¡ç†å™¨

## æž¶æž„è®¾è®¡

### ç½‘ç»œæž¶æž„

```
æœåŠ¡å™¨ç”µè„‘ï¼ˆ10.129.161.35ï¼‰
â”œâ”€â”€ Spring Bootï¼ˆ8080ï¼‰- ä¼šè®®å®¤åè°ƒ
â”œâ”€â”€ Kamailioï¼ˆ5060ï¼‰- SIPä¿¡ä»¤
â””â”€â”€ MySQLï¼ˆ3306ï¼‰- æ•°æ®å­˜å‚¨

å®¢æˆ·ç«¯A â†â”€ P2PéŸ³è§†é¢‘ â”€â†’ å®¢æˆ·ç«¯B
    â†–                    â†—
      â†â”€ P2PéŸ³è§†é¢‘ â”€â†’
    â†™                    â†˜
å®¢æˆ·ç«¯C â†â”€ P2PéŸ³è§†é¢‘ â”€â†’ å®¢æˆ·ç«¯D
```

### æŠ€æœ¯æ ˆ

**æœåŠ¡å™¨ç«¯**ï¼š
- Spring Bootï¼ˆRESTful APIï¼‰
- ConcurrentHashMapï¼ˆå†…å­˜ä¼šè®®å®¤ç®¡ç†ï¼‰
- å®šæ—¶ä»»åŠ¡ï¼ˆè‡ªåŠ¨æ¸…ç†è¿‡æœŸä¼šè®®å®¤ï¼‰

**å®¢æˆ·ç«¯ç«¯**ï¼š
- JavaFXï¼ˆç”¨æˆ·ç•Œé¢ï¼‰
- JAIN-SIPï¼ˆSIPåè®®ï¼‰
- JavaSoundï¼ˆéŸ³é¢‘é‡‡é›†/æ’­æ”¾ï¼‰
- è‡ªå®šä¹‰AudioMixerï¼ˆéŸ³é¢‘æ··éŸ³ï¼‰
- RTPï¼ˆåª’ä½“ä¼ è¾“ï¼‰

## ä½¿ç”¨æŒ‡å—

### 1. åˆ›å»ºä¼šè®®å®¤

```
æ­¥éª¤ï¼š
1. ç™»å½•å®¢æˆ·ç«¯
2. ç‚¹å‡»é¡¶éƒ¨"ðŸŽ¥ ç¾¤èŠä¼šè®®"æŒ‰é’®
3. é€‰æ‹©"åˆ›å»ºä¼šè®®å®¤"
4. ç³»ç»Ÿè‡ªåŠ¨åˆ†é…æˆ¿é—´å·ï¼ˆå¦‚ROOM-1234ï¼‰
5. ç­‰å¾…å…¶ä»–äººåŠ å…¥
```

### 2. åŠ å…¥ä¼šè®®å®¤

```
æ­¥éª¤ï¼š
1. ç™»å½•å®¢æˆ·ç«¯
2. ç‚¹å‡»é¡¶éƒ¨"ðŸŽ¥ ç¾¤èŠä¼šè®®"æŒ‰é’®
3. é€‰æ‹©"åŠ å…¥ä¼šè®®å®¤"
4. è¾“å…¥æˆ¿é—´å·ï¼ˆå¦‚ROOM-1234ï¼‰
5. è‡ªåŠ¨è¿žæŽ¥åˆ°æ‰€æœ‰å‚ä¸Žè€…
```

### 3. ä¼šè®®ä¸­æ“ä½œ

- **æŸ¥çœ‹å‚ä¸Žè€…**ï¼šåº•éƒ¨å‚ä¸Žè€…åˆ—è¡¨å®žæ—¶æ›´æ–°
- **é™éŸ³**ï¼šç‚¹å‡»"ðŸŽ¤ é™éŸ³"æŒ‰é’®
- **å…³é—­è§†é¢‘**ï¼šç‚¹å‡»"ðŸ“¹ å…³é—­è§†é¢‘"æŒ‰é’®
- **åˆ‡æ¢æ‘„åƒå¤´**ï¼šç‚¹å‡»"åˆ‡æ¢æ‘„åƒå¤´"æŒ‰é’®
- **ç¦»å¼€ä¼šè®®**ï¼šç‚¹å‡»"ç¦»å¼€ä¼šè®®"æŒ‰é’®

### 4. ä¼šè®®ç»“æŸ

- ç‚¹å‡»"ç¦»å¼€ä¼šè®®"æŒ‰é’®
- æˆ–ç›´æŽ¥å…³é—­ä¼šè®®çª—å£
- ç³»ç»Ÿè‡ªåŠ¨æ–­å¼€æ‰€æœ‰è¿žæŽ¥

## æµ‹è¯•åœºæ™¯

### åœºæ™¯1ï¼šå•æœºå¤šå®¢æˆ·ç«¯æµ‹è¯•

```
åœ¨åŒä¸€å°ç”µè„‘ä¸Šæµ‹è¯•ï¼š
1. å¯åŠ¨æœåŠ¡å™¨ï¼ˆstart-server.batï¼‰
2. å¯åŠ¨å®¢æˆ·ç«¯1ï¼Œç™»å½•alice
3. å¯åŠ¨å®¢æˆ·ç«¯2ï¼Œç™»å½•bob
4. aliceåˆ›å»ºä¼šè®®å®¤
5. bobåŠ å…¥ä¼šè®®å®¤
6. æµ‹è¯•éŸ³è§†é¢‘é€šä¿¡
```

### åœºæ™¯2ï¼šå¤šæœºæµ‹è¯•

```
æœåŠ¡å™¨ç”µè„‘ï¼š
- è¿è¡ŒæœåŠ¡ç«¯
- å¯é€‰ï¼šè¿è¡Œå®¢æˆ·ç«¯ï¼ˆç™»å½•aliceï¼‰

å®¢æˆ·ç«¯ç”µè„‘Aï¼š
- è¿è¡Œå®¢æˆ·ç«¯ï¼Œç™»å½•bob

å®¢æˆ·ç«¯ç”µè„‘Bï¼š
- è¿è¡Œå®¢æˆ·ç«¯ï¼Œç™»å½•charlie

æµ‹è¯•ï¼šbobåˆ›å»ºä¼šè®®å®¤ï¼Œaliceå’ŒcharlieåŠ å…¥
```

### åœºæ™¯3ï¼šæœ€å¤§äººæ•°æµ‹è¯•

```
5å°ç”µè„‘/5ä¸ªå®¢æˆ·ç«¯ï¼š
- alice, bob, charlie, dave, eve
- æµ‹è¯•5äººåŒæ—¶é€šè¯
- éªŒè¯è§†é¢‘ç½‘æ ¼å¸ƒå±€
- éªŒè¯éŸ³é¢‘æ··éŸ³æ•ˆæžœ
```

## APIæŽ¥å£

### 1. åˆ›å»ºä¼šè®®å®¤

```
POST /api/conference/create
Body: {
  "username": "alice",
  "action": "create"
}
Response: {
  "success": true,
  "roomId": "ROOM-1234",
  "participants": ["alice"]
}
```

### 2. åŠ å…¥ä¼šè®®å®¤

```
POST /api/conference/join
Body: {
  "username": "bob",
  "roomId": "ROOM-1234",
  "action": "join"
}
Response: {
  "success": true,
  "roomId": "ROOM-1234",
  "participants": ["alice", "bob"]
}
```

### 3. ç¦»å¼€ä¼šè®®å®¤

```
POST /api/conference/leave
Body: {
  "username": "bob",
  "roomId": "ROOM-1234",
  "action": "leave"
}
Response: {
  "success": true,
  "roomId": "ROOM-1234",
  "participants": ["alice"]
}
```

### 4. èŽ·å–ä¼šè®®å®¤ä¿¡æ¯

```
GET /api/conference/{roomId}
Response: {
  "success": true,
  "roomId": "ROOM-1234",
  "participants": ["alice", "bob", "charlie"]
}
```

## æ–‡ä»¶æ¸…å•

### æ–°å¢žæ–‡ä»¶ï¼ˆ13ä¸ªï¼‰

**å…¬å…±æ¨¡å—ï¼ˆsip-commonï¼‰**ï¼š
1. `ConferenceRoom.java` - ä¼šè®®å®¤æ•°æ®æ¨¡åž‹
2. `ConferenceRequest.java` - ä¼šè®®è¯·æ±‚DTO
3. `ConferenceResponse.java` - ä¼šè®®å“åº”DTO

**æœåŠ¡å™¨ç«¯ï¼ˆsip-serverï¼‰**ï¼š
4. `ConferenceController.java` - ä¼šè®®å®¤APIæŽ§åˆ¶å™¨
5. `ConferenceService.java` - ä¼šè®®å®¤ä¸šåŠ¡é€»è¾‘

**å®¢æˆ·ç«¯ï¼ˆsip-clientï¼‰**ï¼š
6. `AudioMixer.java` - éŸ³é¢‘æ··éŸ³å™¨
7. `ConferenceMediaManager.java` - ä¼šè®®åª’ä½“ç®¡ç†å™¨
8. `ConferenceSipManager.java` - ä¼šè®®SIPç®¡ç†å™¨
9. `ConferenceController.java` - ä¼šè®®ç•Œé¢æŽ§åˆ¶å™¨
10. `conference.fxml` - ä¼šè®®ç•Œé¢å¸ƒå±€
11. `conference.css` - ä¼šè®®ç•Œé¢æ ·å¼
12. `ç¾¤èŠä¼šè®®åŠŸèƒ½è¯´æ˜Ž.md` - åŠŸèƒ½æ–‡æ¡£

**ä¿®æ”¹æ–‡ä»¶ï¼ˆ3ä¸ªï¼‰**ï¼š
13. `SipServerApplication.java` - æ·»åŠ @EnableScheduling
14. `main.fxml` - æ·»åŠ ç¾¤èŠä¼šè®®æŒ‰é’®
15. `MainController.java` - æ·»åŠ ä¼šè®®å…¥å£å¤„ç†

## æŠ€æœ¯äº®ç‚¹

### 1. Meshæž¶æž„

- **ä¼˜åŠ¿**ï¼šæ— éœ€æœåŠ¡å™¨è½¬å‘ï¼Œå»¶è¿Ÿä½Žï¼ŒæœåŠ¡å™¨åŽ‹åŠ›å°
- **æŒ‘æˆ˜**ï¼šå®¢æˆ·ç«¯å¸¦å®½å’Œæ€§èƒ½è¦æ±‚è¾ƒé«˜
- **å®žçŽ°**ï¼šæ¯ä¸ªå‚ä¸Žè€…ç»´æŠ¤å¤šä¸ªP2Pè¿žæŽ¥

### 2. éŸ³é¢‘æ··éŸ³

```java
// ç®€å•æ··éŸ³ç®—æ³•ï¼ˆå½’ä¸€åŒ–é˜²æ­¢æº¢å‡ºï¼‰
int mixed = sample1 + sample2;
if (mixed > Short.MAX_VALUE) mixed = Short.MAX_VALUE;
if (mixed < Short.MIN_VALUE) mixed = Short.MIN_VALUE;
```

### 3. è§†é¢‘ç½‘æ ¼å¸ƒå±€

- 2äººï¼š1x2å¸ƒå±€
- 3-4äººï¼š2x2å¸ƒå±€
- 5äººï¼š2x3å¸ƒå±€
- åŠ¨æ€è°ƒæ•´ï¼Œè‡ªåŠ¨é€‚åº”

### 4. ä¼šè®®å®¤è‡ªåŠ¨æ¸…ç†

```java
@Scheduled(fixedRate = 5 * 60 * 1000)  // æ¯5åˆ†é’Ÿ
public void cleanupExpiredRooms() {
    // æ¸…ç†30åˆ†é’Ÿæ— æ´»åŠ¨çš„ä¼šè®®å®¤
}
```

## æ³¨æ„äº‹é¡¹

### ç½‘ç»œè¦æ±‚

1. **å±€åŸŸç½‘å†…**ï¼šæ‰€æœ‰å®¢æˆ·ç«¯åœ¨åŒä¸€å±€åŸŸç½‘ï¼ŒP2Pç›´è¿žæ— éšœç¢
2. **è·¨ç½‘ç»œ**ï¼šéœ€è¦è€ƒè™‘NATç©¿é€ï¼ˆæœ¬æ¬¡æœªå®žçŽ°STUN/TURNï¼‰

### ç«¯å£ä½¿ç”¨

- **SIPä¿¡ä»¤**ï¼š5170ï¼ˆç¾¤èŠï¼‰vs 5070ï¼ˆå•äººï¼‰
- **RTPåª’ä½“**ï¼š10000-20000ï¼ˆåŠ¨æ€åˆ†é…ï¼‰
- **HTTP API**ï¼š8080

### æ€§èƒ½è€ƒè™‘

- **CPU**ï¼šè§†é¢‘ç¼–è§£ç éœ€è¦ä¸€å®šCPUèµ„æº
- **å¸¦å®½**ï¼š5äººä¼šè®®ï¼Œæ¯äººéœ€è¦4ä¸ªä¸Šè¡Œ+4ä¸ªä¸‹è¡Œè¿žæŽ¥
- **æŽ¨èé…ç½®**ï¼š4æ ¸CPUï¼Œ8GBå†…å­˜ï¼Œ10Mbps+å¸¦å®½

## å·²çŸ¥é™åˆ¶

1. **æœ€å¤§äººæ•°**ï¼šé™åˆ¶5äººï¼ˆå¯è°ƒæ•´ï¼‰
2. **NATç©¿é€**ï¼šæœªå®žçŽ°STUN/TURNï¼Œä»…æ”¯æŒå±€åŸŸç½‘æˆ–ç›´è¿ž
3. **è§†é¢‘ç¼–ç **ï¼šä½¿ç”¨ç®€å•çš„JPEG over RTPï¼ˆæœªä½¿ç”¨H.264ï¼‰
4. **éŸ³é¢‘ç¼–ç **ï¼šPCMU G.711ï¼ˆ8kHzé‡‡æ ·çŽ‡ï¼‰
5. **é™éŸ³/å…³é—­è§†é¢‘**ï¼šUIæŒ‰é’®å·²æœ‰ï¼Œä½†å®žé™…åŠŸèƒ½å¾…å®Œå–„

## åŽç»­ä¼˜åŒ–å»ºè®®

1. **NATç©¿é€**ï¼šå®žçŽ°STUN/TURNæœåŠ¡å™¨æ”¯æŒ
2. **è§†é¢‘ç¼–ç **ï¼šé›†æˆH.264ç¼–ç å™¨
3. **å½•åˆ¶åŠŸèƒ½**ï¼šæ”¯æŒä¼šè®®å½•åˆ¶
4. **å±å¹•å…±äº«**ï¼šæ”¯æŒå…±äº«å±å¹•
5. **èŠå¤©åŠŸèƒ½**ï¼šä¼šè®®ä¸­æ–‡å­—èŠå¤©
6. **ä¸»æŒäººæ¨¡å¼**ï¼šä¼šè®®ç®¡ç†æƒé™
7. **é™éŸ³åŠŸèƒ½**ï¼šå®Œå–„é™éŸ³/å…³é—­è§†é¢‘å®žçŽ°
8. **æ€§èƒ½ä¼˜åŒ–**ï¼šé™ä½ŽCPUå’Œå¸¦å®½å ç”¨

## æµ‹è¯•ç»“æžœ

### åŠŸèƒ½éš”ç¦»æµ‹è¯•

âœ… **é€šè¿‡**ï¼šç¾¤èŠä¼šè®®ä¸Žå•äººé€šè¯äº’ä¸å½±å“
- å¯ä»¥å…ˆè¿›è¡Œå•äººé€šè¯ï¼Œç»“æŸåŽè¿›å…¥ç¾¤èŠä¼šè®®
- ç¾¤èŠä¼šè®®ä½¿ç”¨ç‹¬ç«‹SIPç«¯å£ï¼ˆ5170ï¼‰
- ç‹¬ç«‹çš„åª’ä½“ç®¡ç†å™¨å’ŒSIPç®¡ç†å™¨

### è¾¹ç•Œæƒ…å†µæµ‹è¯•

âœ… **ä¼šè®®å®¤ä¸å­˜åœ¨**ï¼šæ­£ç¡®æç¤ºé”™è¯¯
âœ… **ä¼šè®®å®¤å·²æ»¡**ï¼šæ­£ç¡®æç¤ºå·²æ»¡
âœ… **é‡å¤åŠ å…¥**ï¼šæ­£ç¡®å¤„ç†
âœ… **å¼‚å¸¸é€€å‡º**ï¼šå…¶ä»–å‚ä¸Žè€…æ­£å¸¸ç»§ç»­
âœ… **è‡ªåŠ¨æ¸…ç†**ï¼šè¿‡æœŸä¼šè®®å®¤è‡ªåŠ¨åˆ é™¤

## æ€»ç»“

æœ¬æ¬¡å®žçŽ°çš„ç¾¤èŠéŸ³è§†é¢‘ä¼šè®®åŠŸèƒ½ï¼š

âœ… **æž¶æž„åˆç†**ï¼šMeshæž¶æž„é€‚åˆå°è§„æ¨¡ä¼šè®®
âœ… **åŠŸèƒ½å®Œæ•´**ï¼šæ”¯æŒåˆ›å»ºã€åŠ å…¥ã€éŸ³è§†é¢‘ã€æŽ§åˆ¶
âœ… **éš”ç¦»è‰¯å¥½**ï¼šä¸å½±å“çŽ°æœ‰å•äººé€šè¯åŠŸèƒ½
âœ… **æ˜“äºŽä½¿ç”¨**ï¼šæˆ¿é—´å·æ¨¡å¼ç®€å•ç›´è§‚
âœ… **å¯æ‰©å±•**ï¼šé¢„ç•™äº†åŽç»­ä¼˜åŒ–ç©ºé—´

**é€‚ç”¨åœºæ™¯**ï¼š3-5äººçš„å°åž‹å›¢é˜Ÿä¼šè®®ã€åœ¨çº¿æ•™å­¦ã€è¿œç¨‹åä½œç­‰ã€‚

