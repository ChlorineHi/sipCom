# 客户端电脑配置清单

## 📋 必需软件

### 1. Java 运行环境（JRE/JDK）

**版本要求**：JDK 8 或更高版本（推荐 JDK 11 或 JDK 17）

#### 检查是否已安装
打开命令提示符或 PowerShell，输入：
```bash
java -version
```

如果显示类似以下内容，说明已安装：
```
java version "1.8.0_xxx" 或更高
Java(TM) SE Runtime Environment (build ...)
```

#### 如果未安装，下载安装

**方案 A：Oracle JDK（推荐用于生产环境）**
- 下载地址：https://www.oracle.com/java/technologies/downloads/
- 选择 Windows x64 Installer
- 下载后双击安装，按默认选项即可

**方案 B：OpenJDK（免费开源）**
- 下载地址：https://adoptium.net/
- 选择 Windows x64 MSI 安装包
- 安装后会自动配置环境变量

#### 验证安装
```bash
java -version
```

---

## 🚫 不需要安装的软件

### ❌ 不需要安装 Maven
- 原因：客户端只运行打包好的 jar 文件，不需要编译

### ❌ 不需要安装 MySQL
- 原因：数据库只在服务器端运行，客户端通过 HTTP API 访问

### ❌ 不需要安装 Kamailio
- 原因：Kamailio 只在服务器端运行，客户端作为 SIP 客户端连接

### ❌ 不需要安装 IDE（Eclipse/IntelliJ IDEA）
- 原因：只是运行程序，不需要开发

---

## 🌐 网络配置

### 1. 确保网络连通

#### 测试网络连接
```bash
# 测试能否连接到服务器
ping 10.129.161.35
```

应该看到：
```
正在 Ping 10.129.161.35 具有 32 字节的数据:
来自 10.129.161.35 的回复: 字节=32 时间<1ms TTL=128
来自 10.129.161.35 的回复: 字节=32 时间<1ms TTL=128
```

#### 测试端口连接
```powershell
# 在 PowerShell 中测试 HTTP 端口
Test-NetConnection -ComputerName 10.129.161.35 -Port 8080

# 测试 SIP 端口
Test-NetConnection -ComputerName 10.129.161.35 -Port 5060
```

应该看到：
```
TcpTestSucceeded : True  # 表示连接成功
```

### 2. 防火墙配置（如果需要）

#### Windows 防火墙

**通常不需要特别配置**，因为：
- 客户端是主动发起连接（出站），Windows 默认允许
- 只有接收 RTP 媒体流时需要入站规则

如果通话时无法接收音视频，需要添加入站规则：

**方法1：图形界面**
1. 打开"Windows Defender 防火墙"
2. 点击"高级设置"
3. 点击"入站规则" → "新建规则"
4. 选择"端口"，下一步
5. 选择"UDP"，特定本地端口：`10000-20000`
6. 允许连接
7. 应用到所有配置文件
8. 名称：`SipEx Client RTP`

**方法2：PowerShell 命令**（需要管理员权限）
```powershell
# 允许 RTP 端口
New-NetFirewallRule -DisplayName "SipEx Client RTP" -Direction Inbound -LocalPort 10000-20000 -Protocol UDP -Action Allow

# 允许 SIP 端口（客户端监听）
New-NetFirewallRule -DisplayName "SipEx Client SIP" -Direction Inbound -LocalPort 5070 -Protocol UDP -Action Allow
```

#### 第三方杀毒软件/防火墙

如果安装了第三方安全软件（如 360、腾讯管家、卡巴斯基等）：
- 首次运行可能会弹出提示
- 选择"允许"或"信任"
- 如果通话有问题，检查是否被阻止

---

## 📁 文件准备

### 方案 A：最简单（推荐）

**需要的文件**：
```
client-deploy/
├── sip-client-1.0.0.jar    # 客户端程序（约 50-100 MB）
└── start.bat               # 启动脚本
```

**获取方式**：
在服务器电脑上运行 `build-client-for-remote.bat`，然后复制生成的 `client-deploy` 文件夹

**运行方式**：
双击 `start.bat`

---

### 方案 B：手动运行（灵活）

**需要的文件**：
```
sip-client-1.0.0.jar    # 只需要这一个文件
```

**运行方式**：
```bash
java -jar sip-client-1.0.0.jar
```

---

## 🔧 配置文件（已内置）

**重要**：如果使用服务器电脑上构建的 jar 包，配置已经内置好了，**不需要额外配置文件**！

配置已包含在 jar 包内：
```
服务器地址：10.129.161.35:8080
SIP 服务器：10.129.161.35:5060
```

---

## 📝 完整配置步骤（从零开始）

### 步骤 1：检查 Java
```bash
java -version
```
- ✅ 如果显示版本号 → 跳到步骤 2
- ❌ 如果报错 → 安装 Java（见上文）

### 步骤 2：测试网络
```bash
ping 10.129.161.35
```
- ✅ 如果有回复 → 继续
- ❌ 如果超时 → 检查网络连接和路由器设置

### 步骤 3：获取客户端文件

**在服务器电脑上**：
```bash
# 运行自动构建脚本
build-client-for-remote.bat
```

**将 `client-deploy` 文件夹复制到客户端电脑**（U 盘、网络共享等方式）

### 步骤 4：运行客户端

在客户端电脑上：
1. 进入 `client-deploy` 文件夹
2. 双击 `start.bat`
3. 等待程序启动

### 步骤 5：测试登录

使用测试账号：
- 用户名：`alice` 或 `bob`
- 密码：`123456`

---

## 🎯 快速检查清单

在客户端电脑上，依次检查：

- [ ] **Java 已安装**
  ```bash
  java -version  # 应显示版本号
  ```

- [ ] **网络连通**
  ```bash
  ping 10.129.161.35  # 应有回复
  ```

- [ ] **HTTP 服务可访问**
  ```
  浏览器打开：http://10.129.161.35:8080
  # 应该能看到页面或错误信息（不是无法连接）
  ```

- [ ] **客户端文件已复制**
  ```
  sip-client-1.0.0.jar 文件存在
  ```

- [ ] **能运行 jar 文件**
  ```bash
  java -jar sip-client-1.0.0.jar  # 应该启动界面
  ```

---

## 🔍 常见问题排查

### 问题1：提示 "java 不是内部或外部命令"

**原因**：Java 未安装或环境变量未配置

**解决**：
1. 安装 Java（见上文）
2. 如果已安装但未配置环境变量：
   ```
   控制面板 → 系统 → 高级系统设置 → 环境变量
   添加到 Path：C:\Program Files\Java\jdk-xx\bin
   ```

### 问题2：双击 jar 文件无反应

**原因**：jar 文件未关联到 Java

**解决**：
```bash
# 使用命令行运行
java -jar sip-client-1.0.0.jar

# 或者右键 → 打开方式 → 选择 Java
```

### 问题3：能启动但无法登录

**原因**：无法连接到服务器

**检查**：
1. 服务器是否运行？
   - Spring Boot (8080)
   - Kamailio (5060)

2. 网络是否连通？
   ```bash
   ping 10.129.161.35
   curl http://10.129.161.35:8080
   ```

3. 防火墙是否阻止？
   - 暂时关闭防火墙测试

### 问题4：能登录但无法通话

**原因**：RTP 端口被阻止

**检查**：
1. 双方客户端都在线？
2. RTP 端口是否开放？
   - 服务器端：10000-20000
   - 客户端：10000-20000

3. 检查客户端控制台输出的错误信息

---

## 📊 配置对比表

| 项目 | 服务器电脑 | 客户端电脑 |
|------|-----------|-----------|
| Java | ✅ 需要（JDK） | ✅ 需要（JRE/JDK） |
| Maven | ✅ 需要 | ❌ 不需要 |
| MySQL | ✅ 需要 | ❌ 不需要 |
| Kamailio | ✅ 需要 | ❌ 不需要 |
| Spring Boot | ✅ 需要 | ❌ 不需要 |
| 客户端 jar | 可选（用于测试） | ✅ 需要 |
| 配置文件修改 | 否（保持 localhost） | 已内置在 jar 中 |
| 防火墙入站规则 | ✅ 需要多个端口 | 可选（仅 RTP） |

---

## 💾 存储空间要求

### 磁盘空间
- Java JRE：约 200 MB
- 客户端 jar：约 50-100 MB
- 运行时临时文件：约 50 MB
- **总计**：约 300-400 MB

### 内存要求
- 最小：512 MB
- 推荐：1 GB 或以上

---

## 🚀 最简部署流程（总结）

### 服务器电脑（一次性操作）
```bash
# 1. 构建客户端包
build-client-for-remote.bat

# 2. 复制 client-deploy 文件夹到 U 盘
```

### 客户端电脑（每台需要配置）
```bash
# 1. 安装 Java（如果没有）
java -version  # 检查

# 2. 从 U 盘复制 client-deploy 文件夹到本地

# 3. 运行
双击 start.bat

# 4. 测试
使用 alice/123456 或 bob/123456 登录
```

---

## 📞 多客户端配置

如果要在多台电脑上运行客户端：

| 电脑 | 需要操作 | 使用账号 |
|------|---------|---------|
| 客户端电脑 A | 完整配置 | alice |
| 客户端电脑 B | 完整配置 | bob |
| 客户端电脑 C | 完整配置 | charlie |

**注意**：
- 每台电脑使用不同账号登录
- 配置过程完全相同
- jar 文件可以复用（复制同一个文件）

---

## ✅ 验证配置成功

### 客户端启动成功的标志

1. **程序界面打开**
   - 看到登录窗口

2. **控制台输出正常**
   ```
   正在连接服务器: 10.129.161.35:8080
   连接成功
   ```

3. **能够登录**
   - 输入 alice/123456
   - 进入主界面

4. **SIP 注册成功**
   - 控制台显示 "SIP注册成功"
   - 状态显示为 "在线"

5. **能够通话**
   - 搜索其他用户
   - 发起通话
   - 接收通话

---

## 📚 相关文档

完成配置后，参考以下文档使用：

- `启动指南.md` - 详细的启动步骤
- `客户端部署指南.md` - 详细的部署说明
- `网络架构说明.md` - 架构和故障排查
- `Linphone测试指南.md` - 功能测试指南

---

## 🆘 需要帮助？

如果遇到问题：
1. 查看 `问题排查与解决方案.md`
2. 检查客户端控制台的错误信息
3. 检查服务器端的日志
4. 确认网络和防火墙配置

